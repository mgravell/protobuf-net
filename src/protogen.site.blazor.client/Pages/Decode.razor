@using ProtoBuf.Models;
@using System.Text.RegularExpressions;
@inject IJSRuntime JsRuntime;

@page "/decode"
<h3>
    Online Protobuf Decoder.
</h3>

<p>This tool will pull apart arbitrary protobuf data (without requiring a schema), displaying the hierarchical content.</p>
<EditForm Model="@model" OnValidSubmit="@DoDecode">
    <DataAnnotationsValidator />
    <div class="form-group">
        <InputSelect id="language" @bind-Value="model.DecodeContentType" class="form-control">
            <option>(select)</option>
            @foreach (var decodeContentType in Enum.GetValues(typeof(DecodeViewModel.DecodeContentTypeEnum)))
            {
                <option value="@decodeContentType">@decodeContentType</option>
            }
        </InputSelect>
    </div>
    @switch (model.DecodeContentType)
    {
        case DecodeViewModel.DecodeContentTypeEnum.Base64:

            <div class="form-group">
                <textarea class="form-control" @bind="model.Base64" placeholder="Base64 string"></textarea>
            </div>
            break;
        case DecodeViewModel.DecodeContentTypeEnum.Hexa:

            <div class="form-group">
                <textarea class="form-control" @bind="model.Hexadecimal" placeholder="Hexadecimal string"></textarea>
            </div>
            break;
        case DecodeViewModel.DecodeContentTypeEnum.File:
            <div class="form-group">

                <input type="file" @ref="fileUpload" id="customFile" />
            </div>
            break;
        default:
            throw new ArgumentOutOfRangeException($"Content type not handled : {model.DecodeContentType}");
    }
    <div class="form-group">
        <div class="form-check">
            <input class="form-check-input" id="opt_recursive" type="checkbox" @bind="model.Recursive" />
            <label class="form-check-label" for="opt_recursive">
                Recursive (slower)
            </label>
        </div>
    </div>
    <div class="form-group">
        <input type="submit" class="btn btn-primary" value="Decode" />
    </div>

    <ValidationSummary />
</EditForm>
@if (decodeModel != null)
{
    <h3>Results</h3>

    <DecodeResult DecodeModel="@decodeModel"></DecodeResult>
}
@code {
    DecodeViewModel model;
    DecodeModel decodeModel;
    ElementReference fileUpload;
    protected override void OnInitialized()
    {
        model = new DecodeViewModel(JsRuntime);
    }
    async Task DoDecode()
    {
        model.FileInput = this.fileUpload;
        decodeModel = await model.GetDecodeModel();
    }

}
